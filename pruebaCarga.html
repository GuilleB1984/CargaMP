<!DOCTYPE html>
<html>
  <head>
    <title>Carga de Producción</title> 
    <link rel="stylesheet" href="styles.css" />
    <!--
   
  -->

    

  <!--
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        background-color: #f0f0f0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: #fff;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
        width: 95%; /* Ajuste para que el contenedor ocupe el 95% del ancho */
      }

      h1 {
        text-align: center;
        margin: 20px;
        margin-bottom: 25px;
        color: #333;
        font-size: 60px; /* Todas las letras son un 25% más grandes */
      }

      form {
        display: grid;
        gap: 10px;
      }

      .form-group {
        display: grid;
        gap: 0px 15px;
        align-items: center;
        grid-template-columns: 1fr 0.9fr;
        text-align: right; /* Alineamos el texto a la derecha */
        margin: 3px;
      }

      label {
        font-weight: bold;
        color: #555;
        font-size: 57.6px; /* Todas las letras son un 25% más grandes */
        display: block;
      }

      .time-input {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .time-input input {
        padding: 8px;
        border: 2px solid #555; /* Borde más oscuro */
        border-radius: 5px;
        font-size: 45px; /* Todas las letras son un 25% más grandes */
        width: 70%; /* Reducción del 30% en el ancho */
        text-align: center;
        margin: 0; /* Alineamos el input a la izquierda */
      }

      .time-separator {
        margin: 0 10px;
        font-size: 60px; /* Todas las letras son un 25% más grandes */
      }

      input[type="number"],
      input[type="text"] {
        padding: 8px;
        border: 2px solid #555; /* Borde más oscuro */
        border-radius: 5px;
        font-size: 45px; /* Todas las letras son un 25% más grandes */
        width: 95%;
        text-align: center; /* Alineamos el texto a la izquierda */
        margin: 0; /* Alineamos el input a la izquierda */
      }

      input[type="hidden"] {
        display: none;
      }

      input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 55.2px; /* Todas las letras son un 25% más grandes */
        cursor: pointer;
        transition: background-color 0.3s;
        margin: 0 auto; /* Centramos el botón horizontalmente */
        display: block;
      }

      input[type="submit"]:hover {
        background-color: #0056b3;
      }

      #productionList {
        margin-top: 20px;
        font-size: 36px; /* 45px - 20% */
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      thead {
        background-color: #007bff;
        color: #fff;
      }

      th,
      td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #ddd;
        width: calc(100% / 4);
        border: 1px dotted #aaa; /* Borde punteado en las celdas */
      }

      th {
        font-size: 37.5px; /* Todas las letras son un 25% más grandes */
      }

      td {
        font-size: 36px; /* Todas las letras son un 25% más grandes */
      }

      textarea {
        padding: 8px;
        border: 2px solid #555; /* Borde más oscuro */
        border-radius: 5px;
        font-size: 45px; /* Todas las letras son un 25% más grandes */
        width: 95%;
        resize: vertical; /* Permite ajustar verticalmente la altura del textarea */
        margin: 0; /* Alineamos el textarea a la izquierda */
      }

      /* Estilos para los mensajes alineados a la derecha y en letra chica */
      .input-info {
        font-size: 15px;
        text-align: right;
        margin-block-start: 0.1em;
        margin-block-end: 0.1em;
      }

      /* Ajustes para dispositivos móviles (sin cambios) 
      @media screen and (max-width: 480px) {
        .container {
          padding: 10px;
        }
        form {
          grid-template-columns: 1fr;
        }
        .time-input {
          justify-content: center;
        }
        .time-separator {
          margin: 0 5px;
        }
        input[type="number"],
        input[type="text"],
        input[type="submit"] {
          font-size: 44px;
          width: 100%;
        }
        label {
          font-size: 43.2px;
        }
        #productionList {
          font-size: 36px;
        }
      }*/
    </style>
  -->

  </head>
  <body>
    <div class="container">
      <h1>Últimos 3 Registros</h1>
      <table id="lastRecords">
        <thead>
          <tr>
            <th style="width: 20%">Inicio</th>
            <th style="width: 20%">Fin</th>
            <th style="width: 20%">Evento</th>
            <th style="width: 30%">Nº de Caja</th>
          </tr>
        </thead>
        <tbody>
          <!-- Los últimos 3 registros se cargarán aquí con JavaScript -->
        </tbody>
      </table>

      <h1>Control de Producción</h1>
      <form id="productionForm">
        <div class="form-group">
          <label for="machineNumber">Máquina:</label>

          <select name="machineNumber" id="machineNumber" required>
            <option value="" disabled selected>Seleccionar Máquina</option>
            <option value="1">Máquina 1</option>
            <option value="2">Máquina 2</option>
            <option value="3">Máquina 3</option>
            <option value="4">Máquina 4</option>
            <option value="5">Máquina 5</option>
            <option value="6">Máquina 6</option>
            <option value="7">Máquina 7</option>
          </select>
        </div>
        <div class="form-group">
          <label for="startHour">Hora Inicio:</label>
          <div class="time-input">
            <input
              type="number"
              name="startHour"
              id="startHour"
              min="0"
              max="23"
              placeholder="Hora"
              required
            />
            <span class="time-separator">:</span>
            <input
              type="number"
              name="startMinute"
              id="startMinute"
              min="0"
              max="59"
              placeholder="Minuto"
              required
            />
          </div>
        </div>
        <div class="form-group">
          <label for="endHour">Hora Fin:</label>
          <div class="time-input">
            <input
              type="number"
              name="endHour"
              id="endHour"
              min="0"
              max="23"
              placeholder="Hora"
              required
            />
            <span class="time-separator">:</span>
            <input
              type="number"
              name="endMinute"
              id="endMinute"
              min="0"
              max="59"
              placeholder="Minuto"
              required
            />
          </div>
        </div>
        <div class="form-group">
          <label for="event">Evento:</label>
          <select name="event" id="event" required>
            <option value="" disabled selected>Seleccionar Evento</option>
            <option value="A">A - Produccion</option>
            <option value="B">B - F. de Personal</option>
            <option value="C">C - C. de Molde</option>
            <option value="D">D - C. de Color/MP</option>
            <option value="E">E - Puesta a Punto</option>
            <option value="F">F - Mantenimiento</option>
            <option value="G">G - Prob. de Proceso</option>
            <option value="H">H - Prob. de Calidad</option>
            <option value="I">I - Pico Tapado</option>
            <option value="J">J - Falta de MP</option>
            <option value="K">K - Otras Paradas</option>
            <option value="L">L - Espera</option>
          </select>
          
        </div>
        <div class="form-group">
          <label for="quantity">Contador:</label>
          <input type="number" name="quantity" id="quantity" min="0" required />
        </div>
        <div class="form-group">
          <label for="boxNumber">Nº de Caja:</label>
          <input
            type="number"
            name="boxNumber"
            id="boxNumber"
            min="0"
            required
          />
        </div>
        <div class="form-group">
          <label for="operator">Operario:</label>
          <input type="text" name="operator" id="operator" required />
        </div>
        <div class="form-group">
          <label for="article">Articulo:</label>
          <input type="text" name="article" id="article" required />
        </div>
        <div class="form-group">
          <label for="material">Material:</label>
          <select name="material" id="material" required>
            <option value="" disabled selected>Seleccionar Material</option>
            <option value="PP">PP</option>
            <option value="AI">AI</option>
            <option value="-">-</option>
            
          </select>
          
          
          
        </div>
        <div class="form-group">
          <label for="color">Color:</label>
          <select name="color" id="color" required>
            <option value="" disabled selected>Seleccionar Color</option>
            <option value="NEGRO">NEGRO</option>
            <option value="NATURAL">NATURAL</option>
            <option value="CRISTAL">CRISTAL</option>
            <option value="BLANCO">BLANCO</option>
            <option value="-">-</option>
            
          </select>
          
        </div>
        <div class="form-group">
          <label for="cycle">Ciclo:</label>
          <input type="number" name="cycle" id="cycle" min="0" required />
        </div>
        <div class="form-group">
          <label for="mouths">Bocas:</label>
          <input type="text" name="mouths" id="mouths" required />
        </div>
        <div class="form-group">
          <label for="observations">Obs.:</label>
          <textarea name="observations" id="observations" rows="1"></textarea>
        </div>
        <input type="submit" value="Cargar" />
      </form>
      <div id="message"></div>
    </div>

    <script>
      const baseUrl = "https://guillermobell.pythonanywhere.com"; // Reemplaza con tu URL de PythonAnywhere

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("productionForm");
    const messageDiv = document.getElementById("message");
    const lastRecords = document
      .getElementById("lastRecords")
      .getElementsByTagName("tbody")[0];

    form.addEventListener("submit", (event) => {
      event.preventDefault();

      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });

      fetch(`${baseUrl}/add_data`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          messageDiv.textContent = data.message;
          messageDiv.style.backgroundColor = "#28a745"; // Cambiar a verde para éxito
          messageDiv.style.color = "#fff"; // Cambiar el color del texto a blanco
          messageDiv.style.border = "2px solid"; // Agregar un borde al mensaje
          messageDiv.style.fontSize = "18px"; // Cambiar el tamaño de fuente
          messageDiv.style.marginTop = "20px"; // Agregar margen superior
          messageDiv.style.padding = "10px"; // Agregar espaciado interno al mensaje
          messageDiv.style.transition =
            "background-color 0.3s, color 0.3s, font-size 0.3s"; // Agregar transiciones para los cambios de estilo
          form.reset();
          loadLastRecords();
        })
        .catch((error) => {
          messageDiv.textContent = "Error al cargar los datos.";
          messageDiv.style.backgroundColor = "#dc3545"; // Cambiar a rojo para error
          messageDiv.style.color = "#fff"; // Cambiar el color del texto a blanco
          messageDiv.style.border = "2px solid"; // Agregar un borde al mensaje
          messageDiv.style.fontSize = "18px"; // Cambiar el tamaño de fuente
          messageDiv.style.marginTop = "20px"; // Agregar margen superior
          messageDiv.style.padding = "10px"; // Agregar espaciado interno al mensaje
          messageDiv.style.transition =
            "background-color 0.3s, color 0.3s, font-size 0.3s"; // Agregar transiciones para los cambios de estilo
          console.error("Error al cargar los datos:", error);
        });
    });

        function loadLastRecords() {
          fetch(`${baseUrl}/get_data`)
            .then((response) => response.json())
            .then((data) => {
              lastRecords.innerHTML = "";
              // Ordenar los registros por la hora de carga (timestamp) de forma ascendente
              const sortedData = data.sort(
                (a, b) => new Date(a.timestamp) - new Date(b.timestamp)
              );
              // Tomar solo los últimos 3 registros
              const lastThreeRecords = sortedData.slice(-3);

              lastThreeRecords.forEach((record) => {
                const row = document.createElement("tr");

                // Formatear las horas y minutos con dos dígitos
                const inicio = formatTime(record.startHour, record.startMinute);
                const fin = formatTime(record.endHour, record.endMinute);

                row.innerHTML = `
                <td style="width: 20%;">${inicio}</td>
                <td style="width: 20%;">${fin}</td>
                <td style="width: 20%;">${record.event}</td>
                <td style="width: 30%;">${record.boxNumber}</td>
                `;
                lastRecords.appendChild(row);
              });
            })
            .catch((error) =>
              console.error("Error al cargar los datos:", error)
            );
        }

        function formatTime(hours, minutes) {
          // Agregar un "0" adelante si las horas o los minutos son de una sola cifra
          const formattedHours = hours.toString().padStart(2, "0");
          const formattedMinutes = minutes.toString().padStart(2, "0");
          return `${formattedHours}:${formattedMinutes}`;
        }

        loadLastRecords();
      });
      const textarea = document.getElementById("observations");

      textarea.addEventListener("input", () => {
        // Ajustar la altura del textarea según el contenido
        textarea.style.height = "auto";
        textarea.style.height = `${textarea.scrollHeight}px`;
      });
    </script>
  </body>
</html>
